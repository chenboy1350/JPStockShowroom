@using JPStockShowRoom.Services.Helper
@using Microsoft.AspNetCore.Mvc.Rendering

@{
    ViewData["PageTitle"] = "หน้าแรก";
}

<div class="wrapper">
    <nav class="main-header navbar navbar-expand navbar-white navbar-light">
        <ul class="navbar-nav">
            <li class="nav-item">
                <a class="nav-link" data-widget="pushmenu" href="#" role="button"><i class="fas fa-bars"></i></a>
                        </li>
            <li class="nav-item d-none d-sm-inline-block">
                <h3>@ViewData["PageTitle"]</h3>
                        </li>
        </ul>
        <ul class="navbar-nav ml-auto">
            <li class="nav-item dropdown">
                <a class="nav-link" data-toggle="dropdown" href="#">
                    <i class="fas fa-user img-size-32 img-circle mr-2"></i>
                    <span>@User.GetUsername()?.ToLower()</span>
                    <input type="hidden" id="hddUserID" value="@User.GetUserId()" />
                            </a>
                        </li>
                    </ul>
    </nav>
    <aside class="main-sidebar sidebar-dark-primary elevation-4 sidebar-mini sidebar-collapse">
        <a href="@Url.Action("Index", "Home")" class="brand-link p-5">
            <i class="fas fa-box-open brand-image ml-2" style="font-size: 1.5rem; color: var(--accent-orange);"></i>
            <span class="brand-text font-weight-light">JP Stock Showroom</span>
        </a>
        <div class="sidebar d-flex flex-column">
            <nav class="mt-2 d-flex flex-column flex-grow-1">
                <ul class="nav nav-pills nav-sidebar flex-column flex-grow-1" data-widget="treeview" role="menu" data-accordion="false">
                    <li class="nav-header">MENU</li>
                    @if (User.HasClaim("Menu", "ReceiveManagement"))
                    {
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-action="@Url.Action("ReceiveManagement", "Home")">
                                <i class="nav-icon fas fa-file-invoice"></i>
                                <p>ใบรับสินค้า</p>
                            </a>
                        </li>
                    }

                    @if (User.HasClaim("Menu", "StockManagement") || true)
                    {
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-action="@Url.Action("StockManagement", "Home")">
                                <i class="nav-icon fas fa-boxes"></i>
                                <p>จัดการ Stock</p>
                            </a>
                        </li>
                    }

                    @if (User.HasClaim("Menu", "UserManagement"))
                    {
                        <li class="nav-header">ADMINISTRATION</li>
                    }

                    @if (User.HasClaim("Menu", "PermissionManagement"))
                    {
                    <li class="nav-item">
                        <a href="#" class="nav-link" data-action="@Url.Action("PermissionManagement", "Home")">
                            <i class="nav-icon fas fa-user-shield"></i>
                            <p>จัดการสิทธิการเข้าถึง</p>
                            </a>
                        </li>
                    }

                    <li class="nav-header"><hr class="border-top"></li>
                    <li class="nav-item mt-auto">
                        <a href="#" id="btnSignOut" class="nav-link">
                            <i class="nav-icon fas fa-sign-out-alt"></i>
                            <p>ออกจากระบบ</p>
                        </a>
                    </li>
                </ul>
            </nav>
        </div>
    </aside>

    <div class="content-wrapper">
        <section class="content">
            <div id="content-container" class="container-fluid py-4">

                <!-- Menu Section -->
                <div class="mc-section mb-5">
                    <div class="mc-section-header text-center mb-4">
                        <h3 class="mc-section-title">
                            <i class="fas fa-th-large text-primary"></i>
                            MENU
                        </h3>
                        <p class="mc-section-subtitle">เลือกเมนูที่ต้องการใช้งาน</p>
                    </div>

                    <div class="row justify-content-center">
                        @if (User.HasClaim("Menu", "ReceiveManagement"))
                        {
                            <div class="col-xl-3 col-lg-4 col-md-6 col-sm-6 col-12 mb-4">
                                <a href="#" class="mc-link" data-action="@Url.Action("ReceiveManagement", "Home")">
                                    <div class="mc-card mc-card--green">
                                        <div class="mc-icon">
                                            <i class="fas fa-file-invoice"></i>
                                        </div>
                                        <div class="mc-content">
                                            <h4 class="mc-title">ใบรับสินค้า</h4>
                                            <p class="mc-desc">บันทึกรับสินค้าเข้าระบบ</p>
                                        </div>
                                        <div class="mc-arrow">
                                            <i class="fas fa-arrow-right"></i>
                                        </div>
                                    </div>
                                </a>
                            </div>
                        }
                        @if (User.HasClaim("Menu", "StockManagement") || true)
                        {
                            <div class="col-xl-3 col-lg-4 col-md-6 col-sm-6 col-12 mb-4">
                                <a href="#" class="mc-link" data-action="@Url.Action("StockManagement", "Home")">
                                    <div class="mc-card mc-card--green">
                                        <div class="mc-icon">
                                            <i class="fas fa-boxes"></i>
                                        </div>
                                        <div class="mc-content">
                                            <h4 class="mc-title">จัดการ Stock</h4>
                                            <p class="mc-desc">จัดการ Stock และถาดสินค้า</p>
                                        </div>
                                        <div class="mc-arrow">
                                            <i class="fas fa-arrow-right"></i>
                                        </div>
                                    </div>
                                </a>
                            </div>
                        }
                    </div>
                </div>

                <!-- Administration Section -->
                @if (User.HasClaim("Menu", "UserManagement") || User.HasClaim("Menu", "EmployeeManagement") || User.HasClaim("Menu", "PermissionManagement") || User.HasClaim("Menu", "FormulaManagement") || User.HasClaim("Menu", "AppSettings"))
                {
                    <div class="mc-section">
                        <div class="mc-section-header text-center mb-4">
                            <h3 class="mc-section-title">
                                <i class="fas fa-cogs text-secondary"></i>
                                ADMINISTRATION
                            </h3>
                            <p class="mc-section-subtitle">จัดการระบบและผู้ใช้งาน</p>
                        </div>

                        <div class="row justify-content-center">
                            @if (User.HasClaim("Menu", "PermissionManagement"))
                            {
                                <div class="col-xl-3 col-lg-4 col-md-6 col-sm-6 col-12 mb-4">
                                    <a href="#" class="mc-link" data-action="@Url.Action("PermissionManagement", "Home")">
                                        <div class="mc-card mc-card--slate">
                                            <div class="mc-icon">
                                                <i class="fas fa-user-shield"></i>
                                            </div>
                                            <div class="mc-content">
                                                <h4 class="mc-title">สิทธิการเข้าถึง</h4>
                                                <p class="mc-desc">กำหนดสิทธิ์ผู้ใช้งาน</p>
                                            </div>
                                            <div class="mc-arrow">
                                                <i class="fas fa-arrow-right"></i>
                                            </div>
                                        </div>
                                    </a>
                                </div>
                            }

                        </div>
                    </div>
                }
            </div>
        </section>
    </div>

    <footer class="main-footer">
        <div class="float-right d-none d-block pr-3">
            <b>App Version</b> @ViewBag.AppVersion
        </div>
        <p></p>
    </footer>

    <aside class="control-sidebar control-sidebar-dark"></aside>
</div>

@section Scripts {
    <script>
        window.urlGetReceived = '@Url.Action("GetReceived", "Home")';
        window.urlGetOrder = '@Url.Action("GetOrder", "Home")';
        window.urlUpdateLotItems = '@Url.Action("UpdateLotItems", "Home")';
        window.urlGetReceivedToAssign = '@Url.Action("GetReceivedToAssign", "Home")';
        window.urlGetTableMember = '@Url.Action("GetTableMember", "Home")';
        window.urlAssignToTable = '@Url.Action("AssignToTable", "Home")';
        window.urlGetTableToReturn = '@Url.Action("GetTableToReturn", "Home")';
        window.urlGetRecievedToReturn = '@Url.Action("GetRecievedToReturn", "Home")';
        window.urlReturnAssignment = '@Url.Action("ReturnAssignment", "Home")';
        window.urlImportReceiveNo = '@Url.Action("ImportReceiveNo", "Home")';
        window.urlUpdateLotByRevNoItems = '@Url.Action("UpdateLotByRevNoItems", "Home")';
        window.urlGetOrderToSendQty = '@Url.Action("GetOrderToSendQty", "Home")';
        window.urlDefineToPack = '@Url.Action("DefineToPack", "Home")';
        window.urlGetTableMemberByAssignedID = '@Url.Action("GetTableMemberByAssignedID", "Home")';
        window.urlGetImage = '@Url.Action("GetImage", "Home")';
        window.urlSendQtyToPackReport = '@Url.Action("SendQtyToPackReport", "Home")';
        window.urlGetReceiveRow = '@Url.Action("GetReceiveRow", "Home")';
        window.urlCheckUser = '@Url.Action("CheckUser", "Home")';
        window.urlGetReceiveList = '@Url.Action("GetReceiveList", "Home")';
        window.urlAddNewBreakDescription = '@Url.Action("AddNewBreakDescription", "Home")';
        window.urlLostReport = '@Url.Action("LostReport", "Home")';
        window.urlBreakReport = '@Url.Action("BreakReport", "Home")';
        window.urlGetCustomLot = '@Url.Action("GetCustomLot", "Home")';
        window.urlGetUser = '@Url.Action("GetUser", "Home")';
        window.urlAddNewUser = '@Url.Action("AddNewUser", "Home")';
        window.urlAvailableEmployee = '@Url.Action("AvailableEmployee", "Home")';
        window.urlEditUser = '@Url.Action("EditUser", "Home")';
        window.urlToggleUserStatus = '@Url.Action("ToggleUserStatus", "Home")';
        window.urlGetLost = '@Url.Action("GetLost", "Home")';
        window.urlAddLost = '@Url.Action("AddLost", "Home")';
        window.urlGetBreak = '@Url.Action("GetBreak", "Home")';
        window.urlAddBreak = '@Url.Action("AddBreak", "Home")';
        window.urlGetOrderToStore = '@Url.Action("GetOrderToStore", "Home")';
        window.urlGetOrderToStoreByLot = '@Url.Action("GetOrderToStoreByLot", "Home")';
        window.urlSendToStore = '@Url.Action("SendToStore", "Home")';
        window.urlConfirmToSendAll = '@Url.Action("ConfirmToSendAll", "Home")';
        window.urlConfirmToSendStore = '@Url.Action("ConfirmToSendStore", "Home")';
        window.urlConfirmToSendMelt = '@Url.Action("ConfirmToSendMelt", "Home")';
        window.urlConfirmToSendExport = '@Url.Action("ConfirmToSendExport", "Home")';
        window.urlConfirmToSendLost = '@Url.Action("ConfirmToSendLost", "Home")';
        window.urlUpdateAppSettings = '@Url.Action("UpdateAppSettings", "Home")';
        window.urlPrintSendToAllReport = '@Url.Action("PrintSendToAllReport", "Home")';
        window.urlGetComparedInvoice = '@Url.Action("GetComparedInvoice", "Home")';
        window.urlGetUnallocatedQuentityToStore = '@Url.Action("GetUnallocatedQuentityToStore", "Home")';
        window.urlGetUserPermission = '@Url.Action("GetUserPermission", "Home")';
        window.urlUpdateUserPermission = '@Url.Action("UpdateUserPermission", "Home")';
        window.urlGetEmployeeByID = '@Url.Action("GetEmployeeByID", "Home")';
        window.urlAddNewEmployee = '@Url.Action("AddNewEmployee", "Home")';
        window.urlEditEmployee = '@Url.Action("EditEmployee", "Home")';
        window.urlToggleEmployeelaStatus = '@Url.Action("ToggleEmployeelaStatus", "Home")';
        window.urlGetEmployee = '@Url.Action("GetEmployee", "Home")';
        window.urlGetLeaderTabel = '@Url.Action("GetLeaderTabel", "Home")';
        window.urlMarkInvoiceAsRead = '@Url.Action("MarkInvoiceAsRead", "Home")';
        window.urlGetConfirmedInvoice = '@Url.Action("GetConfirmedInvoice", "Home")';
        window.urlGetIsMarked = '@Url.Action("GetIsMarked", "Home")';
        window.urlGetSampleReceiveRow = '@Url.Action("GetSampleReceiveRow", "Home")';
        window.urlGetSampleReceiveList = '@Url.Action("GetSampleReceiveList", "Home")';
        window.urlImportSampleReceiveNo = '@Url.Action("ImportSampleReceiveNo", "Home")';
        window.urlCancelImportSampleReceiveNo = '@Url.Action("CancelImportSampleReceiveNo", "Home")';
        window.urlUpdateSampleLotItems = '@Url.Action("UpdateSampleLotItems", "Home")';
        window.urlCancelUpdateSampleLotItems = '@Url.Action("CancelUpdateSampleLotItems", "Home")';
        window.urlGetOrderToPlan = '@Url.Action("GetOrderToPlan", "Home")';
        window.urlGetCancelStoreList = '@Url.Action("GetCancelStoreList", "Home")';
        window.urlGetCancelStoreDetail = '@Url.Action("GetCancelStoreDetail", "Home")';
        window.urlGetCancelMeltList = '@Url.Action("GetCancelMeltList", "Home")';
        window.urlGetCancelMeltDetail = '@Url.Action("GetCancelMeltDetail", "Home")';
        window.urlGetCancelLostList = '@Url.Action("GetCancelLostList", "Home")';
        window.urlGetCancelLostDetail = '@Url.Action("GetCancelLostDetail", "Home")';
        window.urlGetCancelExportList = '@Url.Action("GetCancelExportList", "Home")';
        window.urlGetCancelExportDetail = '@Url.Action("GetCancelExportDetail", "Home")';
        window.urlCancelLostByReceiveNo = '@Url.Action("CancelLostByReceiveNo", "Home")';
        window.urlCancelLostByLotNo = '@Url.Action("CancelLostByLotNo", "Home")';
        window.urlCancelExportByReceiveNo = '@Url.Action("CancelExportByReceiveNo", "Home")';
        window.urlCancelExportByLotNo = '@Url.Action("CancelExportByLotNo", "Home")';
        window.urlCancelStoreByReceiveNo = '@Url.Action("CancelStoreByReceiveNo", "Home")';
        window.urlCancelStoreByLotNo = '@Url.Action("CancelStoreByLotNo", "Home")';
        window.urlCancelMeltByReceiveNo = '@Url.Action("CancelMeltByReceiveNo", "Home")';
        window.urlCancelMeltByLotNo = '@Url.Action("CancelMeltByLotNo", "Home")';

        // Stock Management
        window.urlGetStockList = '@Url.Action("GetStockList", "Home")';
        window.urlGetTrayList = '@Url.Action("GetTrayList", "Home")';
        window.urlGetTrayItems = '@Url.Action("GetTrayItems", "Home")';
        window.urlGetReceivedForTray = '@Url.Action("GetReceivedForTray", "Home")';
        window.urlCreateTray = '@Url.Action("CreateTray", "Home")';
        window.urlDeleteTray = '@Url.Action("DeleteTray", "Home")';
        window.urlAddToTray = '@Url.Action("AddToTray", "Home")';
        window.urlRemoveFromTray = '@Url.Action("RemoveFromTray", "Home")';
        window.urlBorrowFromTray = '@Url.Action("BorrowFromTray", "Home")';
        window.urlReturnToTray = '@Url.Action("ReturnToTray", "Home")';
        window.urlGetBorrowList = '@Url.Action("GetBorrowList", "Home")';
        window.urlWithdrawFromStock = '@Url.Action("WithdrawFromStock", "Home")';
        window.urlGetWithdrawalList = '@Url.Action("GetWithdrawalList", "Home")';
        window.urlGetArticleList = '@Url.Action("GetArticleList", "Home")';
    </script>

    <script src="~/js/ReceiveManagement.js" asp-append-version="true"></script>
    <script src="~/js/PermissionManagement.js" asp-append-version="true"></script>
    <script src="~/js/StockManagement.js" asp-append-version="true"></script>

    <script>
        $(document).ready(function() {
            $('.nav-sidebar .nav-link').on('click', function(e) {
                e.preventDefault();
                var actionUrl = $(this).data('action');

                if (actionUrl) {
                    $('.nav-sidebar .nav-link').removeClass('active');
                    $(this).addClass('active');

                    $('#content-container').html('<div class="mc-loading"><div class="mc-loading-spinner"><i class="fas fa-spinner fa-spin fa-3x text-primary"></i></div><p class="mt-3 text-muted">กำลังโหลด...</p></div>');

                    $.get(actionUrl, function(data) {
                        $('#content-container').html(data);
                        var title = $('#content-container').find('#page-title').data('title');
                        if (title) {
                            $('.navbar-nav h3').text(title);
                        }
                    }).fail(function() {
                        $('#content-container').html('<div class="alert alert-danger m-3 rounded-lg">เกิดข้อผิดพลาดในการโหลดข้อมูล กรุณาลองใหม่อีกครั้ง</div>');
                    });
                }
            });

            $('.mc-link').on('click', function(e) {
                e.preventDefault();
                var actionUrl = $(this).data('action');

                if (actionUrl) {
                    $('.nav-sidebar .nav-link').removeClass('active');
                    $('.nav-sidebar .nav-link').each(function() {
                        if ($(this).data('action') === actionUrl) {
                            $(this).addClass('active');
                            return false;
                        }
                    });

                    $('#content-container').html('<div class="mc-loading"><div class="mc-loading-spinner"><i class="fas fa-spinner fa-spin fa-3x text-primary"></i></div><p class="mt-3 text-muted">กำลังโหลด...</p></div>');

                    $.get(actionUrl, function(data) {
                        $('#content-container').html(data);
                        var title = $('#content-container').find('#page-title').data('title');
                        if (title) {
                            $('.navbar-nav h3').text(title);
                        }
                        window.scrollTo({ top: 0, behavior: 'smooth' });
                    }).fail(function() {
                        $('#content-container').html('<div class="alert alert-danger m-3 rounded-lg">เกิดข้อผิดพลาดในการโหลดข้อมูล กรุณาลองใหม่อีกครั้ง</div>');
                    });
                }
            });

            $('#btnSignOut').on('click', function(e) {
                e.preventDefault();
                $('#loadingIndicator').show();
                $.post('@Url.Action("Logout", "Auth")', function(res) {
                    window.location.href = res.redirectUrl;
                });
            });
        });
    </script>
}

